---
title: Perfiles de certificado definidos por el usuario para tiendas
description: Este tema proporciona una descripción general sobre cómo se utilizan los certificados en las tiendas minoristas.
author: josaw
manager: annbe
ms.date: 10/09/2020
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2020-10-09
ms.dyn365.ops.version: 10.0.15
ms.openlocfilehash: 81fa3770a137471e3d7f8cab3c7d7f37febe64fa
ms.sourcegitcommit: deac22ba5377a912d93fe408c5ae875706378c2d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/16/2021
ms.locfileid: "5018877"
---
# <a name="user-defined-certificate-profiles-for-retail-stores"></a><span data-ttu-id="897ae-103">Perfiles de certificado definidos por el usuario para tiendas</span><span class="sxs-lookup"><span data-stu-id="897ae-103">User-defined certificate profiles for retail stores</span></span>

[!include [banner](../includes/banner.md)]


## <a name="overview"></a><span data-ttu-id="897ae-104">Información general</span><span class="sxs-lookup"><span data-stu-id="897ae-104">Overview</span></span>

<span data-ttu-id="897ae-105">Este tema proporciona una visión general de los perfiles de certificados disponibles en Microsoft Dynamics 365 Commerce.</span><span class="sxs-lookup"><span data-stu-id="897ae-105">This topic provides an overview of the certificate profiles that are available in Microsoft Dynamics 365 Commerce.</span></span> <span data-ttu-id="897ae-106">Esta funcionalidad extiende la característica [Gestionar secretos para canales minoristas](../dev-itpro/manage-secrets.md) agregando soporte para certificados locales.</span><span class="sxs-lookup"><span data-stu-id="897ae-106">This functionality extends the [Manage secrets for retail channels](../dev-itpro/manage-secrets.md) feature by adding support for local certificates.</span></span>

<span data-ttu-id="897ae-107">Mientras el punto de venta (POS) se ejecuta en modo fuera de línea, no puede acceder a los certificados que están almacenados en el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="897ae-107">While the point of sale (POS) is running in offline mode, it can't access the certificates that are stored in the key vault.</span></span> <span data-ttu-id="897ae-108">En su lugar, debería utilizarse el certificado local.</span><span class="sxs-lookup"><span data-stu-id="897ae-108">The local certificate should be used instead.</span></span> <span data-ttu-id="897ae-109">Se admiten las siguientes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="897ae-109">The following capabilities are supported:</span></span>

- <span data-ttu-id="897ae-110">Uso de certificados locales en escenarios de reserva de Key Vault</span><span class="sxs-lookup"><span data-stu-id="897ae-110">Using local certificates in key vault fallback scenarios</span></span>
- <span data-ttu-id="897ae-111">Usar certificados locales sin un almacén de claves (por ejemplo, en una instalación local)</span><span class="sxs-lookup"><span data-stu-id="897ae-111">Using local certificates without a key vault (for example in an on-premises installation)</span></span>
- <span data-ttu-id="897ae-112">Actualización gradual de certificados, donde algunas tiendas y terminales usan una nueva versión del certificado, pero otras tiendas y terminales continúan usando la versión anterior</span><span class="sxs-lookup"><span data-stu-id="897ae-112">Gradual update of certificates, where some stores and terminals use a new version of the certificate, but other stores and terminals continue to use the previous version</span></span>

<span data-ttu-id="897ae-113">La funcionalidad de perfiles de certificado le permite especificar un certificado predeterminado y establecer el orden en que se buscan los certificados del mismo perfil de certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-113">The certificate profiles functionality lets you specify a default certificate and set the order that certificates in the same certificate profile are searched in.</span></span> <span data-ttu-id="897ae-114">Esta funcionalidad también proporciona un enfoque de configuración similar para certificados locales y certificados de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="897ae-114">This functionality also provides a similar setup approach for local certificates and Key Vault certificates.</span></span> <span data-ttu-id="897ae-115">Puede agregar configuraciones específicas de la empresa para los certificados, pero el identificador único entre empresas para cada certificado se puede utilizar en los canales de comercio.</span><span class="sxs-lookup"><span data-stu-id="897ae-115">You can add company-specific settings for certificates, but the unique cross-company identifier for each certificate can be used in the Commerce channels.</span></span>

### <a name="scenarios"></a><span data-ttu-id="897ae-116">Situaciones</span><span class="sxs-lookup"><span data-stu-id="897ae-116">Scenarios</span></span>

<span data-ttu-id="897ae-117">La funcionalidad de perfiles de certificado admite los siguientes escenarios en los canales de comercio:</span><span class="sxs-lookup"><span data-stu-id="897ae-117">The certificate profiles functionality supports the following scenarios in the Commerce channels:</span></span>

- <span data-ttu-id="897ae-118">Uso de certificado local en escenarios de reserva de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="897ae-118">Use a local certificate in key vault fallback scenarios.</span></span> <span data-ttu-id="897ae-119">Algunos ejemplos estos escenarios de reserva son:</span><span class="sxs-lookup"><span data-stu-id="897ae-119">Here are some examples of these fallback scenarios:</span></span>

    - <span data-ttu-id="897ae-120">No se puede acceder al almacenamiento del almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="897ae-120">The key vault storage isn't accessible.</span></span>
    - <span data-ttu-id="897ae-121">No se encuentra un certificado en el almacenamiento del almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="897ae-121">A certificate isn't found in the key vault storage.</span></span>
    - <span data-ttu-id="897ae-122">El PDV se ejecuta en modo fuera de línea.</span><span class="sxs-lookup"><span data-stu-id="897ae-122">The POS is running in offline mode.</span></span>

- <span data-ttu-id="897ae-123">Uso de certificados locales, pero sin almacenarlos en el almacén de claves (por ejemplo, en una instalación local)</span><span class="sxs-lookup"><span data-stu-id="897ae-123">Use local certificates, but without storing them in the key vault (for example, in an on-premises installation).</span></span>
- <span data-ttu-id="897ae-124">Realice una actualización gradual de certificados, donde se utilice una nueva versión del certificado solo en tiendas o en terminales donde la nueva versión ya esté disponible.</span><span class="sxs-lookup"><span data-stu-id="897ae-124">Do a gradual update of certificates, where a new version of the certificate is used only in stores or on terminals where the new version is already available.</span></span>
- <span data-ttu-id="897ae-125">Utilice el mismo certificado en varias empresas.</span><span class="sxs-lookup"><span data-stu-id="897ae-125">Use the same certificate in several companies.</span></span>

## <a name="set-up-certificate-profiles"></a><span data-ttu-id="897ae-126">Configuración de perfiles de certificado</span><span class="sxs-lookup"><span data-stu-id="897ae-126">Set up certificate profiles</span></span>

<span data-ttu-id="897ae-127">El siguiente procedimiento explica cómo configurar perfiles de certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-127">The following procedure explains how to set up certificate profiles.</span></span> <span data-ttu-id="897ae-128">Antes de utilizar perfiles de certificado en los canales comerciales, siga estos pasos para configurar los ajustes.</span><span class="sxs-lookup"><span data-stu-id="897ae-128">Before you use certificate profiles in the Commerce channels, follow these steps to configure the settings.</span></span>

1. <span data-ttu-id="897ae-129">En el espacio de trabajo **Gestión de funciones**, active la característica **Perfiles de certificado definidos por el usuario para tiendas minoristas**.</span><span class="sxs-lookup"><span data-stu-id="897ae-129">In the **Feature management** workspace, turn on the **User-defined certificate profiles for retail stores** feature.</span></span>
2. <span data-ttu-id="897ae-130">Vaya a **Administración del sistema \> Configuración \> Perfiles de certificado**.</span><span class="sxs-lookup"><span data-stu-id="897ae-130">Go to **System administration \> Setup \> Certificate profiles**.</span></span>
3. <span data-ttu-id="897ae-131">Cree un registro y establezca los campos **Perfil de certificado**, **Nombre** y **Descripción** de este.</span><span class="sxs-lookup"><span data-stu-id="897ae-131">Create a record, and set the **Certificate profile**, **Name**, and **Description** fields for it.</span></span>

    > [!NOTE]
    > <span data-ttu-id="897ae-132">El perfil del certificado es un identificador único de un certificado en todas las empresas y componentes comerciales.</span><span class="sxs-lookup"><span data-stu-id="897ae-132">The certificate profile is a unique identifier of a certificate across all companies and Commerce components.</span></span>

3. <span data-ttu-id="897ae-133">En la pestaña **Entidades legales**, agregue una línea y seleccione la entidad legal (empresa) para la que se debe usar el perfil de certificado actual.</span><span class="sxs-lookup"><span data-stu-id="897ae-133">On the **Legal entities** tab, add a line, and select the legal entity (company) that the current certificate profile should be used for.</span></span> <span data-ttu-id="897ae-134">Si el perfil de certificado debe usarse para varias entidades legales, repita este paso para agregar una línea para cada entidad legal adicional.</span><span class="sxs-lookup"><span data-stu-id="897ae-134">If the certificate profile should be used for multiple legal entities, repeat this step to add a line for each additional legal entity.</span></span>
4. <span data-ttu-id="897ae-135">Seleccione **Configuraciones** para abrir la página **Configuración de perfil de certificado**, donde puede ingresar la configuración específica de la empresa para el perfil del certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-135">Select **Settings** to open the **Certificate profile settings** page, where you can enter company-specific settings for the certificate profile.</span></span>

### <a name="certificate-profile-settings"></a><span data-ttu-id="897ae-136">Configuración de perfil de certificado</span><span class="sxs-lookup"><span data-stu-id="897ae-136">Certificate profile settings</span></span>

<span data-ttu-id="897ae-137">Cuando selecciona **Configuraciones** para las líneas de perfil de certificado, aparece la página **Configuración de perfil de certificado**.</span><span class="sxs-lookup"><span data-stu-id="897ae-137">When you select **Settings** for certificate profile lines, the **Certificate profile settings** page appears.</span></span> <span data-ttu-id="897ae-138">Esta página le permite especificar qué certificados se pueden usar cuando se llama al perfil de certificado actual en los canales de comercio.</span><span class="sxs-lookup"><span data-stu-id="897ae-138">This page lets you specify which certificates can be used when the current certificate profile is called in the Commerce channels.</span></span> <span data-ttu-id="897ae-139">También puede especificar el orden en el que se deben buscar los certificados.</span><span class="sxs-lookup"><span data-stu-id="897ae-139">You can also specify the order that certificates should be searched in.</span></span>

> [!NOTE]
> <span data-ttu-id="897ae-140">El campo **Prioridad** se establece automáticamente.</span><span class="sxs-lookup"><span data-stu-id="897ae-140">The **Priority** field is automatically set.</span></span> <span data-ttu-id="897ae-141">Un valor de **1** representa la máxima prioridad.</span><span class="sxs-lookup"><span data-stu-id="897ae-141">A value of **1** represents the highest priority.</span></span> <span data-ttu-id="897ae-142">Cuando se agrega una nueva línea en la página **Configuración de perfil de certificado**, su prioridad se establece en un número que es uno más que la prioridad de la línea anterior.</span><span class="sxs-lookup"><span data-stu-id="897ae-142">When a new line is added on the **Certificate profile settings** page, its priority is set to a number that is one more than the priority of the previous line.</span></span> <span data-ttu-id="897ae-143">Para cambiar la prioridad de una línea específica, seleccione la línea y luego seleccione **Subir** para aumentar la prioridad o **Bajar** para disminuirla.</span><span class="sxs-lookup"><span data-stu-id="897ae-143">To change the priority of a specific line, select the line, and then select either **Move up** to increase the priority or **Move down** to decrease the priority.</span></span>

<span data-ttu-id="897ae-144">Cuando agrega una nueva línea a la página **Configuración de perfil de certificado**, configure los siguientes campos:</span><span class="sxs-lookup"><span data-stu-id="897ae-144">When you add a new line to the **Certificate profile settings** page, set the following fields:</span></span>

- <span data-ttu-id="897ae-145">**Tipo de ubicacion** - Seleccione la ubicación donde se almacena el certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-145">**Location type** – Select the location where the certificate is stored.</span></span> <span data-ttu-id="897ae-146">Este campo tiene dos valores posibles: **Certificado local** y **Almacén de claves**.</span><span class="sxs-lookup"><span data-stu-id="897ae-146">This field has two possible values: **Local certificate** and **Key Vault**.</span></span>
- <span data-ttu-id="897ae-147">**Certificado de Key Vault** - Este campo es obligatorio si configura el campo **Tipo de ubicación** como **Almacén de claves**.</span><span class="sxs-lookup"><span data-stu-id="897ae-147">**Key Vault certificate** – This field is required if you set the **Location type** field to **Key Vault**.</span></span> <span data-ttu-id="897ae-148">Úselo para especificar un certificado secreto de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="897ae-148">Use it to specify a Key Vault certificate secret.</span></span>

    > [!NOTE]
    > <span data-ttu-id="897ae-149">Antes de usar un certificado de Key Vault en perfiles de certificado, asegúrese de cargar un certificado en el almacenamiento de Key Vault y siga las instrucciones en [Configurar el cliente de Azure Key Vault](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span><span class="sxs-lookup"><span data-stu-id="897ae-149">Before you use a Key Vault certificate in certificate profiles, be sure to upload a certificate to the key vault storage, and follow the instructions in [Set up the Azure Key Vault client](https://docs.microsoft.com/dynamics365/finance/localizations/setting-up-azure-key-vault-client).</span></span>

- <span data-ttu-id="897ae-150">**Nombre de la tienda** - Este campo es opcional y está disponible solo si configura el campo **Tipo de ubicación** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="897ae-150">**Store name** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="897ae-151">Úselo para especificar un nombre de tienda predeterminado que debe usarse para buscar certificados locales.</span><span class="sxs-lookup"><span data-stu-id="897ae-151">Use it to specify a default store name that should be used to search local certificates.</span></span>
- <span data-ttu-id="897ae-152">**Ubicación de la tienda** - Este campo es opcional y está disponible solo si configura el campo **Tipo de ubicacion** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="897ae-152">**Store location** – This field is optional and is available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="897ae-153">Úselo para especificar una ubicación de tienda predeterminado que debe usarse para buscar certificados locales.</span><span class="sxs-lookup"><span data-stu-id="897ae-153">Use it to specify a default store location that should be used to search local certificates.</span></span>

    > [!NOTE]
    > <span data-ttu-id="897ae-154">El nombre y la ubicación de la tienda predeterminados se agregan para simplificar el proceso de búsqueda de certificados locales en Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="897ae-154">The default store name and store location are added to simplify the process of searching local certificates in the Commerce runtime.</span></span> <span data-ttu-id="897ae-155">X509StoreProvider tiene una lista de carpetas donde se almacenan los certificados.</span><span class="sxs-lookup"><span data-stu-id="897ae-155">X509StoreProvider has a list of folders where certificates are stored.</span></span> <span data-ttu-id="897ae-156">Si no se especifican el nombre y la ubicación de la tienda predeterminados, X509StoreProvider intenta encontrar un certificado en las otras carpetas de su lista.</span><span class="sxs-lookup"><span data-stu-id="897ae-156">If the default store name and the default store location aren't specified, X509StoreProvider tries to find a certificate in the other folders on its list.</span></span>

- <span data-ttu-id="897ae-157">**Huella digital** - Este campo es obligatorio y está disponible solo si configura el campo **Tipo de ubicacion** como **Certificado local**.</span><span class="sxs-lookup"><span data-stu-id="897ae-157">**Thumbprint** – This field is required and available only if you set the **Location type** field to **Local certificate**.</span></span> <span data-ttu-id="897ae-158">Úselo para especificar la huella digital del certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-158">Use it to specify the certificate thumbprint.</span></span>
- <span data-ttu-id="897ae-159">**Comentarios** - Este campo es opcional y permite a los usuarios ingresar notas.</span><span class="sxs-lookup"><span data-stu-id="897ae-159">**Comments** – This field is optional and lets users enter notes.</span></span>

### <a name="workflow-searching-certificates-in-the-commerce-runtime"></a><span data-ttu-id="897ae-160">Flujo de trabajo: búsqueda de certificados en Commerce Runtime</span><span class="sxs-lookup"><span data-stu-id="897ae-160">Workflow: Searching certificates in the Commerce runtime</span></span>

<span data-ttu-id="897ae-161">Este es el flujo de trabajo básico que se utiliza para buscar un certificado cuando se llama a un perfil de certificado en Commerce Runtime.</span><span class="sxs-lookup"><span data-stu-id="897ae-161">Here is the basic workflow that is used to search for a certificate when a certificate profile is called in the Commerce runtime.</span></span>

1. <span data-ttu-id="897ae-162">El sistema identifica si el perfil de certificado tiene una configuración específica de la empresa para la entidad jurídica actual.</span><span class="sxs-lookup"><span data-stu-id="897ae-162">The system identifies whether the certificate profile has company-specific settings for the current legal entity.</span></span>
1. <span data-ttu-id="897ae-163">El sistema intenta encontrar el certificado utilizando los valores en la página **Configuración de perfil de certificado** de la línea donde el campo **Prioridad** está configurado en **1**.</span><span class="sxs-lookup"><span data-stu-id="897ae-163">The system tries to find the certificate by using the values on the **Certificate profile settings** page for the line where the **Priority** field is set to **1**.</span></span>

    - <span data-ttu-id="897ae-164">Si el campo **Tipo de ubicacion** está configurado como **Almacén de claves**, el valor del campo **Secreto del certificado de Key Vault** se utiliza para buscar el certificado en la página **Parámetros de almacén de claves**.</span><span class="sxs-lookup"><span data-stu-id="897ae-164">If the **Location type** field is set to **Key Vault**, the value of the **Key Vault certificate secret** field is used to search for the certificate on the **Key vault parameters** page.</span></span> <span data-ttu-id="897ae-165">A continuación, se busca el certificado en el almacén de claves.</span><span class="sxs-lookup"><span data-stu-id="897ae-165">The certificate is then searched for in the key vault storage.</span></span>
    - <span data-ttu-id="897ae-166">Si el campo **Tipo de ubicacion** está configurado en **Certificado local**, X509StoreProvider busca primero el certificado utilizando el nombre y la ubicación de la tienda predeterminados, si se especifican estos parámetros.</span><span class="sxs-lookup"><span data-stu-id="897ae-166">If the **Location type** field is set to **Local certificate**, X509StoreProvider first searches for the certificate by using the default store name and store location, if these parameters are specified.</span></span> <span data-ttu-id="897ae-167">Luego busca en todas las demás carpetas de su lista de carpetas.</span><span class="sxs-lookup"><span data-stu-id="897ae-167">It then searches in all other folders on its list of folders.</span></span>

1. <span data-ttu-id="897ae-168">Si no se encuentra el certificado, el proceso se repite para la línea donde el campo **Prioridad** está configurado en **2**, y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="897ae-168">If the certificate isn't found, the process is repeated for the line where the **Priority** field is set to **2**, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="897ae-169">Si el perfil del certificado no tiene configuraciones para la entidad legal actual, o si la búsqueda del certificado no tiene éxito para todas las líneas en la página **Configuración de perfil de certificado**, no se encuentra el certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-169">If the certificate profile has no settings for the current legal entity, or if the certificate search is unsuccessful for all lines on the **Certificate profile settings** page, the certificate isn't found.</span></span>

#### <a name="caching-the-results-of-certificate-searches"></a><span data-ttu-id="897ae-170">Almacenamiento en caché de los resultados de las búsquedas de certificados</span><span class="sxs-lookup"><span data-stu-id="897ae-170">Caching the results of certificate searches</span></span>

<span data-ttu-id="897ae-171">Los resultados de las búsquedas de certificados se almacenan en caché.</span><span class="sxs-lookup"><span data-stu-id="897ae-171">The results of certificate searches are cached.</span></span> <span data-ttu-id="897ae-172">El tiempo de caducidad predeterminado para un caché es una hora.</span><span class="sxs-lookup"><span data-stu-id="897ae-172">The default expiration time for a cache is one hour.</span></span> <span data-ttu-id="897ae-173">Sin embargo, este tiempo se puede personalizar y se puede establecer en un valor máximo de 24 horas.</span><span class="sxs-lookup"><span data-stu-id="897ae-173">However, this time can be customized and can be set to a maximum value of 24 hours.</span></span>

### <a name="gradual-update"></a><span data-ttu-id="897ae-174">Actualización gradual</span><span class="sxs-lookup"><span data-stu-id="897ae-174">Gradual update</span></span>

<span data-ttu-id="897ae-175">Si se introduce una nueva versión del certificado, pero no se puede actualizar en todas las tiendas al mismo tiempo, la funcionalidad de perfiles de certificado permite que el certificado se actualice gradualmente.</span><span class="sxs-lookup"><span data-stu-id="897ae-175">If a new version of the certificate is introduced, but it can't be updated in all stores at the same time, the certificate profiles functionality enables the certificate to be updated gradually.</span></span>

1. <span data-ttu-id="897ae-176">Busque un perfil de certificado y la línea que debe actualizarse, y luego seleccione **Configuraciones**.</span><span class="sxs-lookup"><span data-stu-id="897ae-176">Find a certificate profile and the line that should be updated, and then select **Settings**.</span></span>
1. <span data-ttu-id="897ae-177">Agregue una línea y especifique la configuración relacionada con la última versión del certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-177">Add a line, and specify settings that are related to the latest version of the certificate.</span></span>
1. <span data-ttu-id="897ae-178">Aumente el valor de **Prioridad** de la nueva línea.</span><span class="sxs-lookup"><span data-stu-id="897ae-178">Increase the **Priority** value of the new line.</span></span> <span data-ttu-id="897ae-179">Utilice el botón **Subir** para mover la línea de modo que esté por encima de la línea de la versión anterior del mismo certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-179">Use the **Move up** button to move the line so that it's above the line for the previous version of the same certificate.</span></span>

> [!NOTE]
> <span data-ttu-id="897ae-180">En Commerce Runtime, se llamará primero a la nueva versión del certificado.</span><span class="sxs-lookup"><span data-stu-id="897ae-180">In the Commerce runtime, the new version of the certificate will be called first.</span></span> <span data-ttu-id="897ae-181">Si el certificado aún no se ha actualizado en una tienda específica o en un terminal específico, se llamará a la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="897ae-181">If the certificate hasn't yet been updated in a specific store or on a specific terminal, the previous version will be called.</span></span>
